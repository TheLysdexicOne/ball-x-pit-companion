"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[783],{1735:(e,t,r)=>{r.d(t,{A:()=>s});var a=r(5155);r(2115);var i=r(8214);function s(e){let{hero:t,type:r,scale:s=1,className:l="",onClick:o,onDragStart:n,onDragOver:c,onDrop:d,draggable:g=!1,highlighted:m=!1}=e,p=i.hh[r],u=(0,i.lq)(t.gridX,t.gridY,r),h=p.spriteSize*s;return(0,a.jsx)("div",{className:"relative overflow-hidden ".concat(l," ").concat(g?"cursor-grab active:cursor-grabbing":""),style:{width:h,height:h,imageRendering:"pixelated",...m?{filter:"drop-shadow(0 0 2px rgba(255, 255, 255, 0.9)) drop-shadow(0 0 4px rgba(255, 255, 255, 0.6)) drop-shadow(0 0 8px rgba(255, 255, 255, 0.4))"}:{}},onClick:o,draggable:g,onDragStart:n,onDragOver:c,onDrop:d,title:t.name,children:(0,a.jsx)("div",{style:{width:p.totalSize*s,height:p.totalSize*s,backgroundImage:"url(".concat(p.spriteSheet,")"),backgroundPosition:"-".concat(u.x*s,"px -").concat(u.y*s,"px"),backgroundRepeat:"no-repeat",backgroundSize:"".concat(p.totalSize*s,"px ").concat(p.totalSize*s,"px"),imageRendering:"pixelated"}})})}},3783:(e,t,r)=>{r.d(t,{default:()=>h});var a=r(5155),i=r(2115),s=r(6766),l=r(6874),o=r.n(l),n=r(9501),c=r(2350),d=r(3578),g=r(6664),m=r(4860);function p(e){let{isOpen:t,onClose:r}=e,{activeSlot:s,switchSaveSlot:l,getAllSaveSlots:o,deleteSaveSlot:p}=(0,g.t)(),[u,h]=(0,i.useState)(!1);if(!t)return null;let x=o();return(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/70 p-4",onClick:r,children:[(0,a.jsxs)("div",{className:"relative w-full max-w-2xl rounded-lg border-4 border-[#8b7355] bg-[#2a1810] p-8 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsx)("button",{onClick:r,className:"absolute right-4 top-4 text-3xl text-white/70 transition-colors hover:text-white",title:"Close",children:(0,a.jsx)(c.gc,{icon:d.Jyw})}),(0,a.jsx)("h2",{className:"mb-8 text-center text-4xl font-bold text-[#f4e4c1]",children:"Settings"}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h3",{className:"mb-4 text-2xl font-semibold text-[#f4e4c1]",children:"Save Slots"}),(0,a.jsx)("div",{className:"space-y-3",children:x.map(e=>{let{slot:t,data:r}=e;return(0,a.jsx)("div",{onClick:()=>{t!==s&&l(t)},className:"relative cursor-pointer rounded-lg border-2 p-4 transition-all ".concat(t===s?"border-yellow-500 bg-yellow-500/10":"border-[#8b7355] bg-[#1a0f08] hover:border-yellow-700 hover:bg-yellow-900/20"),children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("span",{className:"text-xl font-bold text-[#f4e4c1]",children:r.name||"Save ".concat(t)}),t===s&&(0,a.jsx)("span",{className:"rounded bg-yellow-600 px-2 py-1 text-xs font-bold text-white",children:"ACTIVE"})]}),(0,a.jsxs)("div",{className:"mt-1 text-sm text-gray-400",children:["Last modified: ",new Date(r.lastModified).toLocaleString()]}),(0,a.jsxs)("div",{className:"mt-1 text-xs text-gray-500",children:[r.lastDifficulty," â€¢ Tier ",r.lastTier]})]}),(0,a.jsx)("button",{onClick:e=>{var r;e.stopPropagation(),confirm("Are you sure you want to delete ".concat((null==(r=x.find(e=>e.slot===t))?void 0:r.data.name)||"Save ".concat(t),"? This cannot be undone."))&&p(t)},className:"ml-4 rounded bg-red-600 px-3 py-1 text-sm font-bold text-white transition-colors hover:bg-red-700",children:"Delete"})]})},t)})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"mb-4 text-2xl font-semibold text-[#f4e4c1]",children:"Quick Links"}),(0,a.jsxs)("button",{onClick:()=>h(!0),className:"flex w-full items-center gap-3 rounded-lg border-2 border-[#8b7355] bg-[#1a0f08] p-4 transition-colors hover:border-yellow-700 hover:bg-yellow-900/20",children:[(0,a.jsx)(c.gc,{icon:d.afW,className:"text-2xl text-[#f4e4c1]"}),(0,a.jsx)("span",{className:"text-xl font-bold text-[#f4e4c1]",children:"Reorder Heroes"})]})]})]}),u&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4 sm:p-8",onClick:()=>h(!1),children:(0,a.jsxs)("div",{className:"relative max-h-[90vh] w-full max-w-screen-lg overflow-auto",onClick:e=>e.stopPropagation(),style:{borderImageSource:"url(".concat((0,n.W)("/images/backgrounds/parchment.png"),")"),borderImageSlice:"100 100 100 100 fill",borderImageRepeat:"repeat",borderImageWidth:"400px",imageRendering:"pixelated"},children:[(0,a.jsx)("button",{className:"absolute right-4 top-4 z-10 font-pixel text-4xl leading-none text-primary hover:text-red-600 sm:right-8 sm:top-8 sm:text-6xl",onClick:()=>h(!1),children:"\xd7"}),(0,a.jsx)("div",{className:"p-6 sm:p-12",children:(0,a.jsx)(m.A,{})})]})})]})}function u(e){let{icon:t,label:r,href:i,onClick:l}=e,d=(0,a.jsxs)("button",{className:"group relative mx-4 h-24 w-24",title:r,onClick:l,children:[(0,a.jsx)(s.default,{src:(0,n.W)("/images/ui/btn1.png"),alt:"",fill:!0,className:"object-contain transition-opacity group-hover:opacity-0"}),(0,a.jsx)(s.default,{src:(0,n.W)("/images/ui/btn2.png"),alt:"",fill:!0,className:"object-contain opacity-0 transition-opacity group-hover:opacity-100"}),(0,a.jsx)("span",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)(c.gc,{icon:t,className:"text-4xl"})})]});return i?(0,a.jsx)(o(),{href:i,children:d}):d}function h(){let[e,t]=(0,i.useState)(!1);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mx-auto mb-12 mt-8",children:(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[(0,a.jsx)(u,{icon:d.afW,label:"Heroes",href:"/"}),(0,a.jsx)(u,{icon:d.lFo,label:"Homestead",href:"/town"}),(0,a.jsx)(s.default,{src:(0,n.W)("/images/logo/logo.png"),alt:"Ball X Pit Logo",width:500,height:200,className:"mx-12 h-auto w-72"}),(0,a.jsx)(u,{icon:d.c_D,label:"Encyclopedia",href:"/encyclopedia"}),(0,a.jsx)(u,{icon:d.BH7,label:"Settings",onClick:()=>t(!0)})]})}),(0,a.jsx)(p,{isOpen:e,onClose:()=>t(!1)})]})}},4860:(e,t,r)=>{r.d(t,{A:()=>d});var a=r(5155),i=r(2115),s=r(8214),l=r(1735),o=r(6664),n=r(9501);let c={portrait:1.2,small:5};function d(){let{getSortedHeroes:e,updateHeroOrders:t}=(0,o.t)(),[r,d]=(0,i.useState)([]),[g,m]=(0,i.useState)("portrait"),[p,u]=(0,i.useState)(null),[h,x]=(0,i.useState)(null),[f,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{if(f)return void b(!1);d(e().map(e=>s.pq.find(t=>t.id===e.heroId)).filter(e=>void 0!==e))},[e,f]);let v=()=>{x(null)};return(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"mb-4 flex flex-col justify-center gap-2 sm:mb-8 sm:flex-row sm:gap-4",children:[(0,a.jsxs)("button",{onClick:()=>m("portrait"),className:"group relative h-16 w-full sm:h-20 sm:w-64",children:[(0,a.jsx)("div",{className:"absolute inset-0 transition-opacity ".concat("portrait"===g?"":"group-hover:opacity-0"),style:{borderImageSource:"url(".concat((0,n.W)("/images/ui/"+("portrait"===g?"btn4":"btn3")+".png"),")"),borderImageSlice:"16 fill",borderImageRepeat:"repeat",borderImageWidth:"64px",imageRendering:"pixelated"}}),"portrait"!==g&&(0,a.jsx)("div",{className:"absolute inset-0 opacity-0 transition-opacity group-hover:opacity-100",style:{borderImageSource:"url(".concat((0,n.W)("/images/ui/btn4.png"),")"),borderImageSlice:"16 fill",borderImageRepeat:"repeat",borderImageWidth:"64px",imageRendering:"pixelated"}}),(0,a.jsx)("span",{className:"absolute inset-0 flex items-center justify-center font-pixel text-2xl tracking-widest sm:text-4xl",children:"PORTRAIT"})]}),(0,a.jsxs)("button",{onClick:()=>m("small"),className:"group relative h-16 w-full sm:h-20 sm:w-64",children:[(0,a.jsx)("div",{className:"absolute inset-0 transition-opacity ".concat("small"===g?"":"group-hover:opacity-0"),style:{borderImageSource:"url(".concat((0,n.W)("/images/ui/"+("small"===g?"btn4":"btn3")+".png"),")"),borderImageSlice:"16 fill",borderImageRepeat:"repeat",borderImageWidth:"64px",imageRendering:"pixelated"}}),"small"!==g&&(0,a.jsx)("div",{className:"absolute inset-0 opacity-0 transition-opacity group-hover:opacity-100",style:{borderImageSource:"url(".concat((0,n.W)("/images/ui/btn4.png"),")"),borderImageSlice:"16 fill",borderImageRepeat:"repeat",borderImageWidth:"64px",imageRendering:"pixelated"}}),(0,a.jsx)("span",{className:"absolute inset-0 flex items-center justify-center font-pixel text-2xl tracking-widest sm:text-4xl",children:"SMALL"})]})]}),(0,a.jsx)("div",{className:"grid grid-cols-3 gap-3 md:grid-cols-4 md:gap-4",children:r.map((e,i)=>{let s;return(0,a.jsx)("div",{className:"flex items-center justify-center transition-all ".concat(h===i?"scale-110":""),onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move",x(i)},onDragLeave:v,onDrop:e=>{if(e.preventDefault(),!p)return;let a=r.findIndex(e=>e.id===p);if(a===i)return;let s=[...r],[l]=s.splice(a,1);s.splice(i,0,l),b(!0),d(s),t(s.map((e,t)=>({heroId:e.id,customIndex:t}))),u(null),x(null)},children:(0,a.jsxs)("div",{className:"group relative aspect-square w-full cursor-grab active:cursor-grabbing",draggable:!0,onDragStart:(s=e.id,e=>{u(s),e.dataTransfer.effectAllowed="move"}),title:e.name,children:[(0,a.jsx)("div",{className:"absolute inset-0 transition-opacity group-hover:opacity-0",style:{borderImageSource:"url(".concat((0,n.W)("/images/ui/portrait-bg-1.png"),")"),borderImageSlice:"8 fill",borderImageRepeat:"repeat",borderImageWidth:"32px",imageRendering:"pixelated"}}),(0,a.jsx)("div",{className:"absolute inset-0 opacity-0 transition-opacity group-hover:opacity-100",style:{borderImageSource:"url(".concat((0,n.W)("/images/ui/portrait-bg-2.png"),")"),borderImageSlice:"8 fill",borderImageRepeat:"repeat",borderImageWidth:"32px",imageRendering:"pixelated"}}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",style:{marginTop:"portrait"===g?"-12px":"0"},children:(0,a.jsx)(l.A,{hero:e,type:g,scale:c[g],highlighted:h===i})})]})},e.id)})})]})}},6664:(e,t,r)=>{r.d(t,{t:()=>u});var a=r(2115),i=r(8214);let s="ball-x-pit-active-slot",l=e=>"ball-x-pit-save-".concat(e),o="progress-data-updated";function n(){window.dispatchEvent(new CustomEvent(o))}function c(){return{version:1,lastUpdated:new Date().toISOString(),heroes:i.pq.map((e,t)=>({heroId:e.id,customIndex:t,levelCompletions:[]}))}}function d(){try{let e=localStorage.getItem(s),t=e?parseInt(e,10):1;return t>=1&&t<=3?t:1}catch(e){return 1}}function g(e){try{let t=localStorage.getItem(l(e));if(!t)return{heroProgress:c(),lastDifficulty:"base",lastTier:0,lastModified:Date.now(),name:"Save ".concat(e)};return JSON.parse(t)}catch(t){return console.error("Failed to load save slot ".concat(e,":"),t),{heroProgress:c(),lastDifficulty:"base",lastTier:0,lastModified:Date.now(),name:"Save ".concat(e)}}}function m(e,t){try{let r={...t,lastModified:Date.now()};localStorage.setItem(l(e),JSON.stringify(r))}catch(t){console.error("Failed to save slot ".concat(e,":"),t)}}function p(e,t){m(e,t),n()}function u(){(0,a.useEffect)(()=>{!function(){try{if(localStorage.getItem(l(1)))return;let e=localStorage.getItem("ball-x-pit-progress");if(!e)return;let t=JSON.parse(e),r=localStorage.getItem("currentDifficulty")||"base",a=parseInt(localStorage.getItem("currentFastTier")||"0",10),i={heroProgress:t,lastDifficulty:r,lastTier:a,lastModified:Date.now(),name:"Save 1"};localStorage.setItem(l(1),JSON.stringify(i)),localStorage.setItem(s,"1"),console.log("Migrated legacy data to save slot 1")}catch(e){console.error("Failed to migrate legacy data:",e)}}()},[]);let[e,t]=(0,a.useState)(()=>d()),[r,i]=(0,a.useState)(()=>g(e)),[u,h]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e=()=>{let e=d();t(e),i(g(e)),h(e=>e+1)};return window.addEventListener(o,e),()=>window.removeEventListener(o,e)},[]);let x=(0,a.useCallback)(()=>[...r.heroProgress.heroes].sort((e,t)=>e.customIndex-t.customIndex),[r.heroProgress.heroes,u]);return(0,a.useCallback)(()=>r.lastDifficulty,[r.lastDifficulty]),(0,a.useCallback)(()=>r.lastTier,[r.lastTier]),{progressData:r.heroProgress,currentDifficulty:r.lastDifficulty,currentTier:r.lastTier,activeSlot:e,setCurrentDifficulty:t=>{let a={...r,lastDifficulty:t};i(a),p(e,a)},setCurrentTier:t=>{let a={...r,lastTier:t};i(a),p(e,a)},updateHeroOrder:(t,a)=>{let s={...r.heroProgress,heroes:r.heroProgress.heroes.map(e=>e.heroId===t?{...e,customIndex:a}:e)},l={...r,heroProgress:s};i(l),p(e,l)},updateHeroOrders:t=>{let a=new Map(r.heroProgress.heroes.map(e=>[e.heroId,e]));t.forEach(e=>{let{heroId:t,customIndex:r}=e,i=a.get(t);i&&(i.customIndex=r)});let s={...r.heroProgress,heroes:Array.from(a.values())},l={...r,heroProgress:s};i(l),p(e,l)},updateLevelCompletion:(t,a,s)=>{let l={...r.heroProgress,heroes:r.heroProgress.heroes.map(e=>{if(e.heroId!==t)return e;let r=e.levelCompletions.findIndex(e=>e.levelId===a&&e.difficulty===s.difficulty);if(!(r>=0))return{...e,levelCompletions:[...e.levelCompletions,{levelId:a,difficulty:s.difficulty||"base",fastTier:s.fastTier||0}]};{let t=[...e.levelCompletions];return t[r]={...t[r],...s},{...e,levelCompletions:t}}})},o={...r,heroProgress:l};i(o),p(e,o)},getHeroProgress:e=>r.heroProgress.heroes.find(t=>t.heroId===e),getSortedHeroes:x,switchSaveSlot:e=>{e<1||e>3||(localStorage.setItem(s,e.toString()),t(e),i(g(e)),n())},getAllSaveSlots:()=>[1,2,3].map(e=>({slot:e,data:g(e)})),deleteSaveSlot:t=>{if(t<1||t>3)return;let r={heroProgress:c(),lastDifficulty:"base",lastTier:0,lastModified:Date.now(),name:"Save ".concat(t)};m(t,r),t===e&&(i(r),n())},resetAllProgress:()=>{let t={heroProgress:c(),lastDifficulty:"base",lastTier:0,lastModified:Date.now(),name:r.name||"Save ".concat(e)};i(t),p(e,t)}}}},8214:(e,t,r)=>{r.d(t,{hh:()=>s,lq:()=>l,pq:()=>i});var a=r(9501);let i=[{id:"warrior",name:"The Warrior",gridX:0,gridY:0},{id:"itchy-finger",name:"The Itchy Finger",gridX:1,gridY:0},{id:"repentant",name:"The Repentant",gridX:2,gridY:0},{id:"cohabitants",name:"The Cohabitants",gridX:3,gridY:0},{id:"embedded",name:"The Embedded",gridX:0,gridY:1},{id:"cogitator",name:"The Cogitator",gridX:1,gridY:1},{id:"empty-nester",name:"The Empty Nester",gridX:2,gridY:1},{id:"shade",name:"The Shade",gridX:3,gridY:1},{id:"shieldbearer",name:"The Shieldbearer",gridX:0,gridY:2},{id:"spendthrift",name:"The Spendthrift",gridX:1,gridY:2},{id:"flagellant",name:"The Flagellant",gridX:2,gridY:2},{id:"juggler",name:"The Juggler",gridX:3,gridY:2},{id:"physicist",name:"The Physicist",gridX:0,gridY:3},{id:"tactician",name:"The Tactician",gridX:1,gridY:3},{id:"makeshift-sysiphus",name:"The Makeshift Sysiphus",gridX:2,gridY:3},{id:"radical",name:"The Radical",gridX:3,gridY:3}],s={portrait:{spriteSheet:(0,a.W)("/images/heroes/heroes-portrait.png"),spriteSize:124,gridSize:4,totalSize:496},small:{spriteSheet:(0,a.W)("/images/heroes/heroes-small.png"),spriteSize:18,gridSize:4,totalSize:72}};function l(e,t,r){let a=s[r];return{x:e*a.spriteSize,y:t*a.spriteSize}}},9501:(e,t,r)=>{r.d(t,{W:()=>a});let a=e=>"".concat("/ball-x-pit-companion").concat(e)}}]);